"use strict";(globalThis.webpackChunkphysical_ai_book=globalThis.webpackChunkphysical_ai_book||[]).push([[6638],{8453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>a});var i=r(6540);const s={},l=i.createContext(s);function t(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(l.Provider,{value:n},e.children)}},9896:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>p,frontMatter:()=>l,metadata:()=>a,toc:()=>c});var i=r(4848),s=r(8453);const l={title:"ROS 2 with Python - rclpy Usage",description:"Comprehensive guide to using ROS 2 with Python through the rclpy client library",tags:["ROS 2","Python","rclpy","Robotics","Programming"]},t="ROS 2 with Python - rclpy Usage",a={id:"week-3-5/ros2-with-python-rclpy",title:"ROS 2 with Python - rclpy Usage",description:"Comprehensive guide to using ROS 2 with Python through the rclpy client library",source:"@site/docs/week-3-5/ros2-with-python-rclpy.md",sourceDirName:"week-3-5",slug:"/week-3-5/ros2-with-python-rclpy",permalink:"/New-Physical-AI-and-Humanoid-Robotics/docs/week-3-5/ros2-with-python-rclpy",draft:!1,unlisted:!1,editUrl:"https://github.com/JaveriaNigar/New-Physical-AI-and-Humanoid-Robotics/docs/week-3-5/ros2-with-python-rclpy.md",tags:[{label:"ROS 2",permalink:"/New-Physical-AI-and-Humanoid-Robotics/docs/tags/ros-2"},{label:"Python",permalink:"/New-Physical-AI-and-Humanoid-Robotics/docs/tags/python"},{label:"rclpy",permalink:"/New-Physical-AI-and-Humanoid-Robotics/docs/tags/rclpy"},{label:"Robotics",permalink:"/New-Physical-AI-and-Humanoid-Robotics/docs/tags/robotics"},{label:"Programming",permalink:"/New-Physical-AI-and-Humanoid-Robotics/docs/tags/programming"}],version:"current",frontMatter:{title:"ROS 2 with Python - rclpy Usage",description:"Comprehensive guide to using ROS 2 with Python through the rclpy client library",tags:["ROS 2","Python","rclpy","Robotics","Programming"]},sidebar:"tutorialSidebar",previous:{title:"ROS 2 Architecture - Nodes, Topics, Services, Actions",permalink:"/New-Physical-AI-and-Humanoid-Robotics/docs/week-3-5/ros2-architecture-nodes-topics-services-actions"},next:{title:"Gazebo Physics, Collisions, Environment Design",permalink:"/New-Physical-AI-and-Humanoid-Robotics/docs/week-6-7/gazebo-physics-collisions-environment-design"}},o={},c=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Introduction to rclpy",id:"introduction-to-rclpy",level:2},{value:"Setting Up a Basic Node",id:"setting-up-a-basic-node",level:2},{value:"Creating Your First Node",id:"creating-your-first-node",level:3},{value:"Understanding Node Creation",id:"understanding-node-creation",level:3},{value:"Publishers and Subscribers in rclpy",id:"publishers-and-subscribers-in-rclpy",level:2},{value:"Creating a Publisher",id:"creating-a-publisher",level:3},{value:"Creating a Subscriber",id:"creating-a-subscriber",level:3},{value:"Advanced Publisher Features",id:"advanced-publisher-features",level:3},{value:"Publisher with Custom QoS",id:"publisher-with-custom-qos",level:4},{value:"Publisher with Latching",id:"publisher-with-latching",level:4},{value:"Services in rclpy",id:"services-in-rclpy",level:2},{value:"Creating a Service Server",id:"creating-a-service-server",level:3},{value:"Creating a Service Client",id:"creating-a-service-client",level:3},{value:"Synchronous Service Client",id:"synchronous-service-client",level:3},{value:"Actions in rclpy",id:"actions-in-rclpy",level:2},{value:"Creating an Action Server",id:"creating-an-action-server",level:3},{value:"Creating an Action Client",id:"creating-an-action-client",level:3},{value:"Parameters in rclpy",id:"parameters-in-rclpy",level:2},{value:"Declaring and Using Parameters",id:"declaring-and-using-parameters",level:3},{value:"Parameter Descriptions",id:"parameter-descriptions",level:3},{value:"Logging in rclpy",id:"logging-in-rclpy",level:2},{value:"Basic Logging",id:"basic-logging",level:3},{value:"Logging with Formatting",id:"logging-with-formatting",level:3},{value:"Timers in rclpy",id:"timers-in-rclpy",level:2},{value:"Basic Timer Usage",id:"basic-timer-usage",level:3},{value:"Multiple Timers",id:"multiple-timers",level:3},{value:"Advanced Node Patterns",id:"advanced-node-patterns",level:2},{value:"Node with Lifecycle Management",id:"node-with-lifecycle-management",level:3},{value:"Node with Multiple Threads",id:"node-with-multiple-threads",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Exception Handling in Callbacks",id:"exception-handling-in-callbacks",level:3},{value:"Timeout Handling",id:"timeout-handling",level:3},{value:"Common Patterns for Robotics Applications",id:"common-patterns-for-robotics-applications",level:2},{value:"Sensor Data Processing Pattern",id:"sensor-data-processing-pattern",level:3},{value:"Robot Control Pattern",id:"robot-control-pattern",level:3},{value:"Performance Optimization Tips",id:"performance-optimization-tips",level:2},{value:"Efficient Message Handling",id:"efficient-message-handling",level:3},{value:"Memory Management",id:"memory-management",level:3},{value:"Debugging Tips",id:"debugging-tips",level:2},{value:"Useful rclpy Debugging Techniques",id:"useful-rclpy-debugging-techniques",level:3},{value:"Exercises",id:"exercises",level:2},{value:"Quiz",id:"quiz",level:2},{value:"Reflection",id:"reflection",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"ros-2-with-python---rclpy-usage",children:"ROS 2 with Python - rclpy Usage"}),"\n",(0,i.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,i.jsx)(n.p,{children:"By the end of this chapter, students will be able to:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Create ROS 2 nodes using rclpy"}),"\n",(0,i.jsx)(n.li,{children:"Implement publishers, subscribers, services, and actions in Python"}),"\n",(0,i.jsx)(n.li,{children:"Handle parameters and logging in ROS 2 Python nodes"}),"\n",(0,i.jsx)(n.li,{children:"Design effective node architectures using rclpy"}),"\n",(0,i.jsx)(n.li,{children:"Debug and optimize Python-based ROS 2 applications"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"introduction-to-rclpy",children:"Introduction to rclpy"}),"\n",(0,i.jsx)(n.p,{children:"rclpy is the Python client library for ROS 2, providing a Python API to interact with the ROS 2 middleware. It allows Python developers to create ROS 2 nodes that can communicate with nodes written in other languages like C++."}),"\n",(0,i.jsx)(n.p,{children:"rclpy provides:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Node creation and management"}),"\n",(0,i.jsx)(n.li,{children:"Publisher and subscriber functionality"}),"\n",(0,i.jsx)(n.li,{children:"Service and action clients and servers"}),"\n",(0,i.jsx)(n.li,{children:"Parameter handling"}),"\n",(0,i.jsx)(n.li,{children:"Logging capabilities"}),"\n",(0,i.jsx)(n.li,{children:"Time and timer utilities"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"setting-up-a-basic-node",children:"Setting Up a Basic Node"}),"\n",(0,i.jsx)(n.h3,{id:"creating-your-first-node",children:"Creating Your First Node"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\n\r\nclass MinimalNode(Node):\r\n    def __init__(self):\r\n        super().__init__('minimal_node')\r\n        self.get_logger().info('Minimal node created')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = MinimalNode()\r\n    \r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"understanding-node-creation",children:"Understanding Node Creation"}),"\n",(0,i.jsx)(n.p,{children:"The basic structure consists of:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Inheriting from ",(0,i.jsx)(n.code,{children:"rclpy.node.Node"})]}),"\n",(0,i.jsxs)(n.li,{children:["Calling ",(0,i.jsx)(n.code,{children:"super().__init__()"})," with a node name"]}),"\n",(0,i.jsxs)(n.li,{children:["Using ",(0,i.jsx)(n.code,{children:"rclpy.init()"})," to initialize the ROS 2 client library"]}),"\n",(0,i.jsxs)(n.li,{children:["Using ",(0,i.jsx)(n.code,{children:"rclpy.spin()"})," to keep the node alive"]}),"\n",(0,i.jsxs)(n.li,{children:["Properly cleaning up with ",(0,i.jsx)(n.code,{children:"node.destroy_node()"})," and ",(0,i.jsx)(n.code,{children:"rclpy.shutdown()"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"publishers-and-subscribers-in-rclpy",children:"Publishers and Subscribers in rclpy"}),"\n",(0,i.jsx)(n.h3,{id:"creating-a-publisher",children:"Creating a Publisher"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import String\r\n\r\nclass MinimalPublisher(Node):\r\n    def __init__(self):\r\n        super().__init__('minimal_publisher')\r\n        self.publisher_ = self.create_publisher(String, 'topic', 10)\r\n        timer_period = 0.5  # seconds\r\n        self.timer = self.create_timer(timer_period, self.timer_callback)\r\n        self.i = 0\r\n\r\n    def timer_callback(self):\r\n        msg = String()\r\n        msg.data = 'Hello World: %d' % self.i\r\n        self.publisher_.publish(msg)\r\n        self.get_logger().info('Publishing: \"%s\"' % msg.data)\r\n        self.i += 1\n"})}),"\n",(0,i.jsx)(n.h3,{id:"creating-a-subscriber",children:"Creating a Subscriber"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import String\r\n\r\nclass MinimalSubscriber(Node):\r\n    def __init__(self):\r\n        super().__init__('minimal_subscriber')\r\n        self.subscription = self.create_subscription(\r\n            String,\r\n            'topic',\r\n            self.listener_callback,\r\n            10)\r\n        self.subscription  # prevent unused variable warning\r\n\r\n    def listener_callback(self, msg):\r\n        self.get_logger().info('I heard: \"%s\"' % msg.data)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"advanced-publisher-features",children:"Advanced Publisher Features"}),"\n",(0,i.jsx)(n.h4,{id:"publisher-with-custom-qos",children:"Publisher with Custom QoS"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from rclpy.qos import QoSProfile, QoSHistoryPolicy, QoSReliabilityPolicy\r\n\r\nclass PublisherWithQoS(Node):\r\n    def __init__(self):\r\n        super().__init__('qos_publisher')\r\n        \r\n        qos_profile = QoSProfile(\r\n            history=QoSHistoryPolicy.KEEP_LAST,\r\n            depth=10,\r\n            reliability=QoSReliabilityPolicy.BEST_EFFORT\r\n        )\r\n        \r\n        self.publisher_ = self.create_publisher(\r\n            String, \r\n            'qos_topic', \r\n            qos_profile\r\n        )\n"})}),"\n",(0,i.jsx)(n.h4,{id:"publisher-with-latching",children:"Publisher with Latching"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from rclpy.qos import QoSProfile, QoSDurabilityPolicy\r\n\r\nclass LatchedPublisher(Node):\r\n    def __init__(self):\r\n        super().__init__('latched_publisher')\r\n        \r\n        latched_qos = QoSProfile(\r\n            depth=1,\r\n            durability=QoSDurabilityPolicy.TRANSIENT_LOCAL\r\n        )\r\n        \r\n        self.publisher_ = self.create_publisher(\r\n            String, \r\n            'latched_topic', \r\n            latched_qos\r\n        )\n"})}),"\n",(0,i.jsx)(n.h2,{id:"services-in-rclpy",children:"Services in rclpy"}),"\n",(0,i.jsx)(n.h3,{id:"creating-a-service-server",children:"Creating a Service Server"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from example_interfaces.srv import AddTwoInts\r\nimport rclpy\r\nfrom rclpy.node import Node\r\n\r\nclass MinimalService(Node):\r\n    def __init__(self):\r\n        super().__init__('minimal_service')\r\n        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_two_ints_callback)\r\n\r\n    def add_two_ints_callback(self, request, response):\r\n        response.sum = request.a + request.b\r\n        self.get_logger().info('Incoming request\\na: %d b: %d' % (request.a, request.b))\r\n        return response\n"})}),"\n",(0,i.jsx)(n.h3,{id:"creating-a-service-client",children:"Creating a Service Client"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from example_interfaces.srv import AddTwoInts\r\nimport rclpy\r\nfrom rclpy.node import Node\r\n\r\nclass MinimalClientAsync(Node):\r\n    def __init__(self):\r\n        super().__init__('minimal_client_async')\r\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\r\n        while not self.cli.wait_for_service(timeout_sec=1.0):\r\n            self.get_logger().info('service not available, waiting again...')\r\n        self.req = AddTwoInts.Request()\r\n\r\n    def send_request(self, a, b):\r\n        self.req.a = a\r\n        self.req.b = b\r\n        self.future = self.cli.call_async(self.req)\r\n        rclpy.spin_until_future_complete(self, self.future)\r\n        return self.future.result()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"synchronous-service-client",children:"Synchronous Service Client"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class MinimalClientSync(Node):\r\n    def __init__(self):\r\n        super().__init__('minimal_client_sync')\r\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\r\n\r\n    def send_request(self, a, b):\r\n        while not self.cli.wait_for_service(timeout_sec=1.0):\r\n            self.get_logger().info('service not available, waiting again...')\r\n        \r\n        request = AddTwoInts.Request()\r\n        request.a = a\r\n        request.b = b\r\n        \r\n        future = self.cli.call_async(request)\r\n        rclpy.spin_until_future_complete(self, future)\r\n        return future.result()\n"})}),"\n",(0,i.jsx)(n.h2,{id:"actions-in-rclpy",children:"Actions in rclpy"}),"\n",(0,i.jsx)(n.h3,{id:"creating-an-action-server",children:"Creating an Action Server"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.action import ActionServer\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.action import Fibonacci\r\n\r\nclass FibonacciActionServer(Node):\r\n    def __init__(self):\r\n        super().__init__('fibonacci_action_server')\r\n        self._action_server = ActionServer(\r\n            self,\r\n            Fibonacci,\r\n            'fibonacci',\r\n            self.execute_callback)\r\n\r\n    def execute_callback(self, goal_handle):\r\n        self.get_logger().info('Executing goal...')\r\n        \r\n        feedback_msg = Fibonacci.Feedback()\r\n        feedback_msg.sequence = [0, 1]\r\n        \r\n        for i in range(1, goal_handle.request.order):\r\n            if goal_handle.is_cancel_requested:\r\n                goal_handle.canceled()\r\n                self.get_logger().info('Goal canceled')\r\n                return Fibonacci.Result()\r\n            \r\n            feedback_msg.sequence.append(\r\n                feedback_msg.sequence[i] + feedback_msg.sequence[i-1])\r\n            \r\n            goal_handle.publish_feedback(feedback_msg)\r\n            \r\n        goal_handle.succeed()\r\n        result = Fibonacci.Result()\r\n        result.sequence = feedback_msg.sequence\r\n        return result\n"})}),"\n",(0,i.jsx)(n.h3,{id:"creating-an-action-client",children:"Creating an Action Client"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.action import ActionClient\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.action import Fibonacci\r\n\r\nclass FibonacciActionClient(Node):\r\n    def __init__(self):\r\n        super().__init__('fibonacci_action_client')\r\n        self._action_client = ActionClient(\r\n            self,\r\n            Fibonacci,\r\n            'fibonacci')\r\n\r\n    def send_goal(self, order):\r\n        goal_msg = Fibonacci.Goal()\r\n        goal_msg.order = order\r\n\r\n        self._action_client.wait_for_server()\r\n        self._send_goal_future = self._action_client.send_goal_async(\r\n            goal_msg,\r\n            feedback_callback=self.feedback_callback)\r\n\r\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\r\n\r\n    def goal_response_callback(self, future):\r\n        goal_handle = future.result()\r\n        if not goal_handle.accepted:\r\n            self.get_logger().info('Goal rejected')\r\n            return\r\n\r\n        self.get_logger().info('Goal accepted')\r\n        self._get_result_future = goal_handle.get_result_async()\r\n        self._get_result_future.add_done_callback(self.get_result_callback)\r\n\r\n    def feedback_callback(self, feedback_msg):\r\n        feedback = feedback_msg.feedback\r\n        self.get_logger().info('Received feedback: {0}'.format(feedback.sequence))\n"})}),"\n",(0,i.jsx)(n.h2,{id:"parameters-in-rclpy",children:"Parameters in rclpy"}),"\n",(0,i.jsx)(n.h3,{id:"declaring-and-using-parameters",children:"Declaring and Using Parameters"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\n\r\nclass ParameterNode(Node):\r\n    def __init__(self):\r\n        super().__init__('parameter_node')\r\n        \r\n        # Declare parameters with default values\r\n        self.declare_parameter('param1', 'default_value')\r\n        self.declare_parameter('param2', 10)\r\n        self.declare_parameter('param3', 3.14)\r\n        \r\n        # Get parameter values\r\n        self.param1 = self.get_parameter('param1').value\r\n        self.param2 = self.get_parameter('param2').value\r\n        self.param3 = self.get_parameter('param3').value\r\n        \r\n        self.get_logger().info(f'param1: {self.param1}')\r\n        self.get_logger().info(f'param2: {self.param2}')\r\n        self.get_logger().info(f'param3: {self.param3}')\r\n\r\n    def update_parameters_callback(self, parameters):\r\n        for param in parameters:\r\n            if param.name == 'param1' and param.type_ == Parameter.Type.STRING:\r\n                self.param1 = param.value\r\n                self.get_logger().info(f'Updated param1 to: {self.param1}')\r\n        return SetParametersResult(successful=True)\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = ParameterNode()\r\n    \r\n    # Add parameter callback\r\n    node.add_on_set_parameters_callback(node.update_parameters_callback)\r\n    \r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"parameter-descriptions",children:"Parameter Descriptions"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from rcl_interfaces.msg import ParameterDescriptor\r\n\r\nclass ParameterNodeWithDescriptions(Node):\r\n    def __init__(self):\r\n        super().__init__('param_desc_node')\r\n        \r\n        # Declare parameter with description\r\n        param_desc = ParameterDescriptor(\r\n            type=ParameterType.PARAMETER_STRING,\r\n            description='A string parameter for configuration',\r\n            additional_constraints='Must be a valid configuration option'\r\n        )\r\n        \r\n        self.declare_parameter('config_option', 'default', param_desc)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"logging-in-rclpy",children:"Logging in rclpy"}),"\n",(0,i.jsx)(n.h3,{id:"basic-logging",children:"Basic Logging"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\n\r\nclass LoggingNode(Node):\r\n    def __init__(self):\r\n        super().__init__('logging_node')\r\n        \r\n        # Different log levels\r\n        self.get_logger().debug('This is a debug message')\r\n        self.get_logger().info('This is an info message')\r\n        self.get_logger().warn('This is a warning message')\r\n        self.get_logger().error('This is an error message')\r\n        self.get_logger().fatal('This is a fatal message')\n"})}),"\n",(0,i.jsx)(n.h3,{id:"logging-with-formatting",children:"Logging with Formatting"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class AdvancedLoggingNode(Node):\r\n    def __init__(self):\r\n        super().__init__('advanced_logging_node')\r\n        \r\n        # Using formatted logging\r\n        value = 42\r\n        self.get_logger().info(f'The value is {value}')\r\n        \r\n        # Logging with context\r\n        self.get_logger().info('Processing data for robot_name: %s', self.get_parameter('robot_name').value)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"timers-in-rclpy",children:"Timers in rclpy"}),"\n",(0,i.jsx)(n.h3,{id:"basic-timer-usage",children:"Basic Timer Usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\n\r\nclass TimerNode(Node):\r\n    def __init__(self):\r\n        super().__init__('timer_node')\r\n        self.timer_period = 0.5  # seconds\r\n        self.timer = self.create_timer(self.timer_period, self.timer_callback)\r\n        self.counter = 0\r\n\r\n    def timer_callback(self):\r\n        self.get_logger().info('Timer callback executed: %d' % self.counter)\r\n        self.counter += 1\n"})}),"\n",(0,i.jsx)(n.h3,{id:"multiple-timers",children:"Multiple Timers"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class MultipleTimerNode(Node):\r\n    def __init__(self):\r\n        super().__init__('multiple_timer_node')\r\n        \r\n        # Different frequency timers\r\n        self.slow_timer = self.create_timer(1.0, self.slow_timer_callback)  # 1 Hz\r\n        self.fast_timer = self.create_timer(0.1, self.fast_timer_callback)  # 10 Hz\r\n\r\n    def slow_timer_callback(self):\r\n        self.get_logger().info('Slow timer executed')\r\n\r\n    def fast_timer_callback(self):\r\n        self.get_logger().info('Fast timer executed')\n"})}),"\n",(0,i.jsx)(n.h2,{id:"advanced-node-patterns",children:"Advanced Node Patterns"}),"\n",(0,i.jsx)(n.h3,{id:"node-with-lifecycle-management",children:"Node with Lifecycle Management"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from rclpy.lifecycle import LifecycleNode, LifecycleState\r\nfrom rclpy.lifecycle import TransitionCallbackReturn\r\n\r\nclass LifecycleExampleNode(LifecycleNode):\r\n    def __init__(self):\r\n        super().__init__('lifecycle_example_node')\r\n        self.get_logger().info('Lifecycle node created')\r\n\r\n    def on_configure(self, state):\r\n        self.get_logger().info('Configuring node')\r\n        return TransitionCallbackReturn.SUCCESS\r\n\r\n    def on_activate(self, state):\r\n        self.get_logger().info('Activating node')\r\n        return TransitionCallbackReturn.SUCCESS\r\n\r\n    def on_deactivate(self, state):\r\n        self.get_logger().info('Deactivating node')\r\n        return TransitionCallbackReturn.SUCCESS\r\n\r\n    def on_cleanup(self, state):\r\n        self.get_logger().info('Cleaning up node')\r\n        return TransitionCallbackReturn.SUCCESS\n"})}),"\n",(0,i.jsx)(n.h3,{id:"node-with-multiple-threads",children:"Node with Multiple Threads"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import threading\r\nimport rclpy\r\nfrom rclpy.node import Node\r\n\r\nclass ThreadedNode(Node):\r\n    def __init__(self):\r\n        super().__init__('threaded_node')\r\n        self.lock = threading.Lock()\r\n        self.shared_data = 0\r\n        \r\n        # Create a timer to simulate periodic work\r\n        self.timer = self.create_timer(0.5, self.main_thread_work)\r\n        \r\n        # Start a background thread\r\n        self.background_thread = threading.Thread(target=self.background_work)\r\n        self.background_thread.start()\r\n\r\n    def main_thread_work(self):\r\n        with self.lock:\r\n            self.shared_data += 1\r\n        self.get_logger().info(f'Main thread: shared_data = {self.shared_data}')\r\n\r\n    def background_work(self):\r\n        while rclpy.ok():\r\n            with self.lock:\r\n                self.shared_data *= 2\r\n            self.get_logger().info(f'Background thread: shared_data = {self.shared_data}')\r\n            time.sleep(1)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,i.jsx)(n.h3,{id:"exception-handling-in-callbacks",children:"Exception Handling in Callbacks"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import traceback\r\n\r\nclass ErrorHandlingNode(Node):\r\n    def __init__(self):\r\n        super().__init__('error_handling_node')\r\n        self.subscription = self.create_subscription(\r\n            String,\r\n            'topic',\r\n            self.error_safe_callback,\r\n            10)\r\n\r\n    def error_safe_callback(self, msg):\r\n        try:\r\n            # Process message\r\n            result = process_message(msg)\r\n            self.get_logger().info(f'Processed: {result}')\r\n        except Exception as e:\r\n            self.get_logger().error(f'Error processing message: {str(e)}')\r\n            self.get_logger().error(f'Traceback: {traceback.format_exc()}')\r\n            \r\ndef process_message(msg):\r\n    # Simulate potential error\r\n    if 'error' in msg.data:\r\n        raise ValueError('Error in message')\r\n    return f'Result for: {msg.data}'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"timeout-handling",children:"Timeout Handling"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import rclpy\r\nfrom rclpy.node import Node\r\nfrom rclpy.task import Future\r\n\r\nclass TimeoutNode(Node):\r\n    def __init__(self):\r\n        super().__init__(\'timeout_node\')\r\n        \r\n    def wait_with_timeout(self, future, timeout_sec=5.0):\r\n        """Wait for a future with timeout"""\r\n        timer = self.create_timer(0.1, lambda: None)  # Dummy timer to keep spinning\r\n        try:\r\n            rclpy.spin_until_future_complete(self, future, timeout_sec=timeout_sec)\r\n            if future.done():\r\n                return future.result()\r\n            else:\r\n                self.get_logger().error(\'Timeout occurred\')\r\n                return None\r\n        finally:\r\n            timer.destroy()\n'})}),"\n",(0,i.jsx)(n.h2,{id:"common-patterns-for-robotics-applications",children:"Common Patterns for Robotics Applications"}),"\n",(0,i.jsx)(n.h3,{id:"sensor-data-processing-pattern",children:"Sensor Data Processing Pattern"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom sensor_msgs.msg import JointState\r\n\r\nclass SensorProcessorNode(Node):\r\n    def __init__(self):\r\n        super().__init__('sensor_processor')\r\n        self.subscription = self.create_subscription(\r\n            JointState,\r\n            'joint_states',\r\n            self.joint_state_callback,\r\n            10)\r\n        \r\n        # Store recent sensor data\r\n        self.joint_positions = {}\r\n        \r\n    def joint_state_callback(self, msg):\r\n        # Update internal state\r\n        for i, name in enumerate(msg.name):\r\n            if i < len(msg.position):\r\n                self.joint_positions[name] = msg.position[i]\r\n        \r\n        # Process data\r\n        self.process_joint_data()\r\n        \r\n    def process_joint_data(self):\r\n        # Perform calculations based on joint positions\r\n        if 'left_leg_joint' in self.joint_positions:\r\n            pos = self.joint_positions['left_leg_joint']\r\n            # Process the position data\r\n            self.get_logger().info(f'Left leg position: {pos}')\n"})}),"\n",(0,i.jsx)(n.h3,{id:"robot-control-pattern",children:"Robot Control Pattern"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import Float64MultiArray\r\nfrom sensor_msgs.msg import JointState\r\n\r\nclass RobotControllerNode(Node):\r\n    def __init__(self):\r\n        super().__init__('robot_controller')\r\n        \r\n        # Publishers for control commands\r\n        self.command_publisher = self.create_publisher(\r\n            Float64MultiArray, \r\n            'joint_commands', \r\n            10\r\n        )\r\n        \r\n        # Subscribers for sensor feedback\r\n        self.feedback_subscription = self.create_subscription(\r\n            JointState,\r\n            'joint_states',\r\n            self.feedback_callback,\r\n            10\r\n        )\r\n        \r\n        # Timer for control loop\r\n        self.control_timer = self.create_timer(0.01, self.control_loop)  # 100Hz\r\n        \r\n    def feedback_callback(self, msg):\r\n        # Store feedback for control calculations\r\n        self.current_positions = dict(zip(msg.name, msg.position))\r\n        \r\n    def control_loop(self):\r\n        # Calculate control commands based on desired and current state\r\n        commands = self.calculate_control_command()\r\n        \r\n        # Publish commands\r\n        cmd_msg = Float64MultiArray()\r\n        cmd_msg.data = commands\r\n        self.command_publisher.publish(cmd_msg)\r\n        \r\n    def calculate_control_command(self):\r\n        # Implement your control algorithm here\r\n        return [0.0] * 10  # Placeholder\n"})}),"\n",(0,i.jsx)(n.h2,{id:"performance-optimization-tips",children:"Performance Optimization Tips"}),"\n",(0,i.jsx)(n.h3,{id:"efficient-message-handling",children:"Efficient Message Handling"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# For high-frequency topics, consider using callbacks that do minimal work\r\nclass EfficientNode(Node):\r\n    def __init__(self):\r\n        super().__init__('efficient_node')\r\n        # Use smaller queue sizes for time-sensitive data\r\n        self.sub = self.create_subscription(\r\n            String, 'high_freq_topic', \r\n            self.high_freq_callback, 1)  # Small queue size\r\n\r\n    def high_freq_callback(self, msg):\r\n        # Do minimal processing in callback\r\n        # Store data and process it elsewhere if needed\r\n        self.processed_data = msg.data\n"})}),"\n",(0,i.jsx)(n.h3,{id:"memory-management",children:"Memory Management"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class MemoryEfficientNode(Node):\r\n    def __init__(self):\r\n        super().__init__('memory_efficient_node')\r\n        # Pre-allocate message objects if publishing frequently\r\n        self.msg_cache = String()  # Reuse this object\r\n        \r\n    def timer_callback(self):\r\n        # Reuse message object instead of creating new ones\r\n        self.msg_cache.data = f'New data at {self.get_clock().now()}'\r\n        self.publisher.publish(self.msg_cache)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"debugging-tips",children:"Debugging Tips"}),"\n",(0,i.jsx)(n.h3,{id:"useful-rclpy-debugging-techniques",children:"Useful rclpy Debugging Techniques"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Check node status\r\ndef check_node_status(node):\r\n    print(f"Node name: {node.get_name()}")\r\n    print(f"Node namespace: {node.get_namespace()}")\r\n    print(f"Node clock: {node.get_clock().now()}")\r\n    \r\n    # List all subscriptions and publications\r\n    subscriptions = node.get_subscriptions_info_by_topic(\'topic_name\')\r\n    publishers = node.get_publishers_info_by_topic(\'topic_name\')\r\n    \r\n    print(f"Subscriptions: {subscriptions}")\r\n    print(f"Publishers: {publishers}")\n'})}),"\n",(0,i.jsx)(n.h2,{id:"exercises",children:"Exercises"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Create a node that publishes joint commands at 100Hz and another that subscribes to joint states, implementing a simple PD controller."}),"\n",(0,i.jsx)(n.li,{children:"Implement a service that calculates inverse kinematics for a humanoid robot arm."}),"\n",(0,i.jsx)(n.li,{children:"Design an action server that controls a humanoid robot's walking gait with feedback on step progress."}),"\n",(0,i.jsx)(n.li,{children:"Create a parameter server that allows changing robot control parameters at runtime."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"quiz",children:"Quiz"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"What is the primary purpose of rclpy?"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A) To provide a Python interface to ROS 2"}),"\n",(0,i.jsx)(n.li,{children:"B) To manage ROS 2 network connections"}),"\n",(0,i.jsx)(n.li,{children:"C) To compile ROS 2 code"}),"\n",(0,i.jsx)(n.li,{children:"D) To visualize ROS 2 data"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Which method is used to keep a ROS 2 node active?"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A) rclpy.run()"}),"\n",(0,i.jsx)(n.li,{children:"B) rclpy.spin()"}),"\n",(0,i.jsx)(n.li,{children:"C) rclpy.start()"}),"\n",(0,i.jsx)(n.li,{children:"D) rclpy.active()"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"How do you properly shut down a ROS 2 node in Python?"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A) node.shutdown()"}),"\n",(0,i.jsx)(n.li,{children:"B) rclpy.stop()"}),"\n",(0,i.jsx)(n.li,{children:"C) node.destroy_node() and rclpy.shutdown()"}),"\n",(0,i.jsx)(n.li,{children:"D) exit()"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"reflection",children:"Reflection"}),"\n",(0,i.jsx)(n.p,{children:"Consider how the Python ecosystem and rclpy integration makes ROS 2 accessible to a broader range of developers. What are the trade-offs of using Python for robot control (performance vs. development speed)? How might the design patterns you've learned be applied to complex humanoid robot systems with multiple sensors and actuators? What challenges might arise when using Python in real-time robotic applications?"})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);